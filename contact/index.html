<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <title>Margo Biret</title>
    <link rel="stylesheet" href="../style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="mport" href="/nav.html">
</head>
<body>
    <!-- ===================================================== */
      /*                       Navbar                          */
      /* ===================================================== */ -->
    <nav class="navbar">
        <a href="/portfolio_html">
            <img src="../img/Margo_montagne_coupé.png" alt="Logo" class="logo">
        </a>
        <button class="hamburger">☰</button>
        <div class="nav-links-container">
            <a href="/portfolio_html/a-propos/" class="nav-links">À propos de moi</a>
            <a href="/portfolio_html/portfolio/" class="nav-links">Projets</a>
            <a href="/portfolio_html/contact/" class="nav-links">Contact</a>
        </div>
    </nav>
    <!-- ===================================================== */
    /*                          Contact                        */
    /* ======================================================= */ -->
    <div class="body-content">
        <h1>CONTACT</h1>
        <div class="card contact">
            <div class="card-title">
                <h3>Mes informations</h3>
                <span>X</span>
            </div>
            <div class="card-content">
                <p>Envoyer un mail :<a href="mailto:margobiret@yahoo.fr">margobiret@yahoo.fr</a></p>
                <p>Découvrir mon profil sur LinkedIn : <a href="https://www.linkedin.com/in/margo-biret" target="_blank"><img src="../img/linkedin-icon.png" class="social-icon-contact"/></a></p>
                <p>Voir mes projets de codes sur GitHub: <a href="https://github.com/Margob29" target="_blank"><img src="../img/github-mark.png" class="social-icon-contact"/></a></p>
            </div>
        </div>
        <div class="contact-container">
            <div class="contact-info">
                <div>
                    <h2>Prendre rendez-vous</h2>
                    <p>Je suis disponible pour discuter de votre projet ou répondre à vos questions !</p>
                    <p>Réservez un premier appel gratuit d'1h maximum pour échanger sur vos besoins.</p>
                    <!-- widget en ligne Calendly -->
                    <div class="calendly-inline-widget" data-url="https://calendly.com/margobiret/60min?hide_event_type_details=1&text_color=446aa4&primary_color=8b5b1a" style="min-width:250px;height:700px;"></div>
                </div>
            </div>
            <div class="contact-form">
                <h2>Formulaire de contact</h2>
                <form method="post">
                    <div class="form-content">
                        <label for="name">Nom et prénom *</label>
                        <input type="text" id="name" name="name" required placeholder="Ex: Margo Biret">
                    </div>
                    <div class="form-content">
                        <label for="company">Raison sociale</label>
                        <input type="text" id="company" name="company" placeholder="Nom de votre entreprise ou de votre association">
                    </div>
                    <div class="form-content">
                        <legend for="contact">Comment vous recontacter (au moins 1) * : </legend>
                        <div class="checkbox">
                            <!-- <input type="checkbox" id="email" name="mail" value="email"> -->
                            <label for="email"><input type="email" id="email" name="email" placeholder="Adresse mail"></label>
                            <!-- <input type="checkbox" id="phone" name="phone" value="phone"> -->
                            <input type="tel" id="telephone" name="telephone" placeholder="Numéro de téléphone">
                        </div>
                    </div>
                    <div class="form-content">
                        <label for="url">Site existant</label>
                        <p>Vous avez déjà un site ? Je peux aller voir de quoi vous parlez !</p>
                        <input type="url" id="url" name="url" placeholder="Url de votre site (ex: https://www.votresite.fr)"></textarea>
                    </div>
                    <div class="form-content">
                        <label for="message">Votre message *</label>
                        <p>Des questions sur ce qu'il est possible de faire ? Un devis pour votre projet ? Une idée déjà
                            en tête ?</p>
                        <textarea id="message" name="message" rows="4" placeholder="N'hésitez pas à détailler !"
                            required></textarea>
                        <p style="margin-top: 10px;">* obligatoires</p>
                    </div>
                    <div class="form-btn">
                        <input type="submit" value="Envoyer" class="btn">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- ===================================================== */
      /*                        Footer                         */
      /* ===================================================== */ -->
    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h4>LIENS UTILES</h4>
                <a href="/portfolio_html/a-propos/" class="footer-link">A propos</a>
                <a href="/portfolio_html/portfolio/" class="footer-link">Projets</a>
            </div>
            <div class="footer-column">
                <a href="/portfolio_html">
                    <img src="../img/Margo_montage_entier.png" alt="Logo" class="logo-footer"/>
                </a>
            </div>
            <div class="footer-column">
                <h4>CONTACT</h4>
                <a href="mailto:margobiret@yahoo.fr" class="footer-link">margobiret@yahoo.fr</a>
                <a href="/portfolio_html/contact/" class="footer-link">Formulaire de contact</a>
                <div>
                    <p>Réseaux : </p>
                    <a href="https://www.linkedin.com/in/margo-biret" target="_blank"><img src="../img/linkedin-icon.png" class="social-icon"/></a>
                    <a href="https://github.com/Margob29" target="_blank"><img src="../img/github-mark.png" class="social-icon"/></a>
                </div>
            </div>
        </div>
    </footer>
    <!-- ===================================================== */
    /*                        Scripts                          */
    /* ======================================================= */ -->
    <!-- Calendly widget -->
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
    <script>
        // Hamburger menu toggle
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links-container');
        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        var form = document.forms[0]
        var emailEl = form["email"]
        var nameEl = form["name"]
        var companyEl = form["company"]
        var telEl = form["telephone"]
        var websiteEl = form["url"]
        var messageEl = form["message"]

        // Mark as invalid by default and set custom error message
        emailEl.setCustomValidity("Veuillez saisir ce champs ou un numéro de téléphone")
        telEl.setCustomValidity("Veuillez saisir ce champs ou une addresse email")

        function checkEmailAndPhoneValidity() {
            // Reset custom validity to check default validity first
            telEl.setCustomValidity("")
            emailEl.setCustomValidity("")

            // Check validity of contact
            const numIsValid = telEl.checkValidity() && telEl.value.length > 0;
            const emailIsValid = emailEl.checkValidity() && emailEl.value.length > 0;
            // Phone validity is kind of useless (no real check) so checking length > 0 is enough
            // Maybe add some custom phone validity check instead

            // If one is valid, let both as valid and return
            if (numIsValid || emailIsValid) {
                return
            }
            // Else mark both as invalid with custom error message
            const msg = "Entrer au moins l'un de ces deux champs"
            telEl.setCustomValidity(msg)
            emailEl.setCustomValidity(msg)
        }

        emailEl.addEventListener("input", (e) => checkEmailAndPhoneValidity())
        telEl.addEventListener("input", (e) => checkEmailAndPhoneValidity())



        // Intercept form submit event
        form.addEventListener("submit", (event) => {
            // Stop request from being sent
            event.preventDefault()

            const name = nameEl.value
            const email = emailEl.value
            const company = companyEl.value
            const tel = telEl.value
            const website = websiteEl.value
            const message = messageEl.value

            const subject = "[PORTFOLIO] Demande de contact de " + name + " @ " + company
            // TODO put in sperate file and build in a function (with indexed param ?)
            const content =
                `
Coucou Margo,

${name} ${company ? "de chez " + company : ""} vous a contacté sur votre portfolio.

Informations:
${email ? "\t- email: " + email + "\n" : ""}${tel ? "\t- numéro: " + tel + "\n" : ""}${website ? "\t- site web: " + website + "\n" : ""}

Avec le message suivant:
"
${message}
"
            


mail envoyé automatiquement, ne pas répondre
            
bisous <3
`

            // We're sending our own custom request
            sendmail(subject, content)
                .then(res => {
                    form.reset()
                    alert(res) // Do something to tell the user it worked

                })
                .catch(err => {
                    alert("Error occured, please try again later or contact the site admin")
                    console.log("error", err)
                })
        })

        async function sendmail(subject, content) {
            var myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer 332d68fa-7a3b-4cdd-af01-12e9648d9bec");

            var formdata = new FormData();
            formdata.append("to", "[email_address]");
            formdata.append("subject", subject);
            formdata.append("content", content);

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: formdata,
            };

            return fetch("http://89.168.60.207:8080/send", requestOptions)
                .then(response => response.text())
        }
    </script>
</body>

